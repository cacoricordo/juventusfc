<!DOCTYPE html>
<html>
<head>
  <title>OS INVICTOS -- Soccer-Tool 'Juventus Football Club'</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.osinvictos.com.br/">
  <meta property="og:title" content="Juventus FC vs A.I.">
  <meta property="og:description" content="Campe√£ Invicta 2011-12 com 23 vit√≥rias e 15 empates">
  <meta property="og:image" content="https://juventusfc.onrender.com/img/trofeujoia.png">
  <meta property="og:image:width" content="580">
  <meta property="og:image:height" content="464">
  <meta name="google-adsense-account" content="ca-pub-6390604470898441">
  <link rel="stylesheet" href="styles.css">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZDWS2F3NE8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZDWS2F3NE8');
  </script>
</head>

<body style="background-image: url('https://juventusfc.onrender.com/img/estadium.jpg'); background-size: cover; background-repeat: no-repeat; background-position: center;">

  <!-- ======== Campo e elementos ======== -->
  <div id="background-square" class="background-square"></div>
  <div id="background-line"></div><div id="background-line2"></div><div id="background-line3"></div>
  <div id="background-line4"></div><div id="background-line5"></div><div id="background-line6"></div>
  <div id="background-line7"></div><div id="background-line8"></div><div id="background-line9"></div>
  <div id="background-line10"></div><div id="background-line11"></div><div id="background-line12"></div>
  <div id="background-line13"></div><div id="background-line14"></div><div id="background-line15"></div>
  <div id="background-line16"></div><div id="background-line17"></div>

  <div id="circle12" class="circlecentral" style="background: transparent; left: 237px; top: 100px; border: 2px solid #ffffff;"></div>
  <div id="gol-square" class="gol-square"></div>
  <div id="gol2-square" class="gol2-square"></div>

  <!-- Jogadores (azul e vermelho) -->
  <div id="circle1" class="circle">1</div>
  <div id="circle2" class="circle">2</div>
  <div id="circle3" class="circle">3</div>
  <div id="circle4" class="circle">4</div>
  <div id="circle5" class="circle">5</div>
  <div id="circle6" class="circle">6</div>
  <div id="circle7" class="circle">7</div>
  <div id="circle8" class="circle">8</div>
  <div id="circle9" class="circle">9</div>
  <div id="circle10" class="circle">10</div>
  <div id="circle11" class="circle">11</div>

  <div id="circle13" class="circle" style="background: #ff3333;">11</div>
  <div id="circle14" class="circle" style="background: #ff3333;">2</div>
  <div id="circle15" class="circle" style="background: #ff3333;">3</div>
  <div id="circle16" class="circle" style="background: #ff3333;">4</div>
  <div id="circle17" class="circle" style="background: #ff3333;">5</div>
  <div id="circle18" class="circle" style="background: #ff3333;">6</div>
  <div id="circle19" class="circle" style="background: #ff3333;">7</div>
  <div id="circle20" class="circle" style="background: #ff3333;">8</div>
  <div id="circle21" class="circle" style="background: #ff3333;">9</div>
  <div id="circle22" class="circle" style="background: #ff3333;">10</div>
  <div id="circle23" class="circle">01</div>
  <div id="circle24" class="circle"></div>

  <!-- Overlays -->
  <div id="fullscreen-overlay" style="position: fixed; left:0; top:0; width:100vw; height:100vh; background: rgba(0,0,0,0.7); color: #fff; display: flex; align-items: center; justify-content: center; z-index: 9999; font-size: 2em; cursor: pointer;">
    Toque para entrar na Mesa T√°tica
  </div>

  <button id="exit-fullscreen-btn" style="position: fixed; top: 330px; left: 20px; z-index: 10000; font-size: 1.2em; padding: 10px 18px; border-radius: 8px; background: #222; color: #fff; border: none; cursor: pointer; display: none; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">Sair (x)</button>
  <button id="pen-path-btn" style="position: fixed; top: 330px; left: 302px; z-index: 10000; font-size: 1.2em; padding: 10px 18px; border-radius: 8px; background: #222; color: #fff; border: none; cursor: pointer; display: none; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">‚úé Desenho T√°tico</button>
  <button id="ai-analise-btn" style="position: fixed; top: 330px; left: 120px; z-index: 10000; font-size: 1.2em; padding: 10px 18px; border-radius: 8px; background: #33aaff; color: #fff; border: none; cursor: pointer; display: none; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">AI An√°lise</button>

  <canvas id="trace-canvas" width="600" height="300" style="position:absolute; left:20px; top:20px; z-index: 10; pointer-events: none; border-radius:8px; background:transparent; display: block;"></canvas>
  <div id="ai-notification" style="display:none; position:fixed; bottom:40px; left:50%; transform:translateX(-50%); background:#33aaff; color:#fff; padding:18px 32px; border-radius:8px; z-index:10001; font-size:1.3em; box-shadow:0 2px 10px rgba(0,0,0,0.18);"></div>

  <img src="img/iuve.png" alt="Juventus FC" style="position: fixed; right: 0; bottom: 0; width: 200px; height: auto; z-index: 9000; opacity: 0.85; pointer-events: none;">

  <!-- ======== Scripts ======== -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    /* === Fun√ß√µes de Fullscreen e bot√µes === */
    // (mant√©m todo o comportamento original)
    function updateExitButton() {
      const btn = document.getElementById('exit-fullscreen-btn');
      if (document.fullscreenElement) btn.style.display = 'block';
      else btn.style.display = 'none';
    }
    document.addEventListener('fullscreenchange', updateExitButton);
    document.getElementById('fullscreen-overlay').addEventListener('click', async function() {
      const el = document.documentElement;
      if (el.requestFullscreen) await el.requestFullscreen();
      document.getElementById('fullscreen-overlay').style.display = 'none';
      updateExitButton();
      updatePenPathButton();
      updateAIButton();
    });
    document.getElementById('exit-fullscreen-btn').addEventListener('click', async function() {
      if (document.exitFullscreen) await document.exitFullscreen();
      updateExitButton(); updatePenPathButton(); updateAIButton();
    });
  </script>

  <!-- Mant√©m os scripts de movimenta√ß√£o e AI -->
  <script src="field.js"></script> <!-- opcional se quiser separar -->
  <script>
    // üîÑ AI An√°lise (igual antes)
    function updateAIButton() {
      const btn = document.getElementById('ai-analise-btn');
      if (document.fullscreenElement) btn.style.display = 'block';
      else btn.style.display = 'none';
    }

    document.addEventListener('fullscreenchange', updateAIButton);

    function getGreenTeamPositions() {
      const arr = [];
      for (let i = 2; i <= 11; i++) {
        const el = document.getElementById('circle' + i);
        arr.push({ id: i, left: parseInt(el.style.left || el.offsetLeft), top: parseInt(el.style.top || el.offsetTop) });
      }
      return arr;
    }
    function setRedTeamPositions(red) {
      for (const p of red) {
        const el = document.getElementById('circle' + p.id);
        if (el) { el.style.left = p.left + 'px'; el.style.top = p.top + 'px'; }
      }
    }
    function getBallPosition() {
      const el = document.getElementById('circle24');
      return { left: parseInt(el.style.left || el.offsetLeft), top: parseInt(el.style.top || el.offsetTop) };
    }
    function showAINotification(msg) {
      const notif = document.getElementById('ai-notification');
      notif.textContent = msg;
      notif.style.display = 'block';
      setTimeout(() => notif.style.display = 'none', 2200);
    }

    document.getElementById('ai-analise-btn').addEventListener('click', async function() {
      this.textContent = "Analisando...";
      this.disabled = true;
      try {
        const res = await fetch('/ai/analyze', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ green: getGreenTeamPositions(), ball: getBallPosition() })
        });
        const data = await res.json();
        if (data.red) { setRedTeamPositions(data.red); showAINotification("AI posicionou o time vermelho!"); }
      } catch { showAINotification("Erro na an√°lise."); }
      this.textContent = "AI An√°lise";
      this.disabled = false;
    });
  </script>

  <!-- ======== üí¨ Chat do Treinador Portugu√™s ======== -->
  <div id="coach-chat" style="position: fixed; bottom: 20px; right: 20px; width: 320px; height: 420px; background: rgba(30,30,30,0.95); border: 2px solid #444; border-radius: 12px; display: flex; flex-direction: column; font-family: sans-serif; color: #fff; z-index: 12000;">
    <div style="padding:10px; background:#222; border-bottom:1px solid #555;"><b>Treinador</b> üß†</div>
    <div id="chat-log" style="flex:1; overflow-y:auto; padding:10px;"></div>
    <div style="display:flex; border-top:1px solid #555;">
      <input id="chat-input" placeholder="Fale com o mister..." style="flex:1; background:#111; color:#fff; border:none; padding:10px; outline:none;">
      <button id="send-btn" style="background:#33aaff; border:none; color:white; padding:10px; cursor:pointer;">‚ñ∂</button>
    </div>
  </div>

  <script>
    const chatLog = document.getElementById("chat-log");
    const input = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");

    async function sendMessage() {
      const userText = input.value.trim();
      if (!userText) return;
      addMessage("Voc√™", userText);
      input.value = "";

      const personality = `
      √âs um treinador portugu√™s lend√°rio, sarc√°stico, confiante e direto.
      Foste campe√£o no Porto, Chelsea, Inter, Real Madrid e Manchester United.
      Fala com autoridade, ironia e sempre como se fosses o centro das aten√ß√µes.
      `;
      const prompt = `${personality}\n\nJogador: ${userText}\nTreinador:`;

      try {
        const response = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: prompt })
        });
        const data = await response.json();
        addMessage("Treinador", data.reply);
      } catch {
        addMessage("Treinador", "T√°s a brincar comigo? O servidor falhou...");
      }
    }

    sendBtn.onclick = sendMessage;
    input.addEventListener("keydown", (e) => { if (e.key === "Enter") sendMessage(); });

    function addMessage(sender, text) {
      const el = document.createElement("div");
      el.style.marginBottom = "8px";
      el.innerHTML = `<b>${sender}:</b> ${text}`;
      chatLog.appendChild(el);
      chatLog.scrollTop = chatLog.scrollHeight;
    }
  </script>
</body>
</html>

